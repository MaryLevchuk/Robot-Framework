*** Settings ***
Resource          PreRequisits.txt

*** Keywords ***
Get all recipes to translate
    Set Request Headers
    GET    /${instance}/translation/recipe
    Get Response Body

Get recipe to translate by ID
    [Arguments]    ${recipe_id}
    Set Request Headers
    GET    /${instance}/translation/recipe/${recipe_id}
    ${response_body}=    Get Response Body
    [Return]    ${response_body}

Get recipe translation part from
    [Arguments]    ${json_body}
    ${translation_part}=    Get Json Value    ${json_body}    /TranslationRecipe
    [Return]    ${translation_part}

Send recipe translation
    [Arguments]    ${json_data}
    Set Request Headers
    Set Request Body    ${json_data}
    POST    /${instance}/translation/recipe/${recipe_id}

Update recipe field
    [Arguments]    ${field}    ${value}
    ${response_body}=    Get recipe to translate by ID    ${recipe_id}
    ${translation}=    Get recipe translation part from    ${response_body}
    ${translation}=    Set Json Value    ${translation}    /${field}    ${value}
    ${json_data}=    json.dumps    ${translation}
    [Return]    ${json_data}

Update recipe translation
    [Arguments]    ${field_name}    ${value}
    ${json_data}=    Update recipe field    /${field_name}    ${value}
    Send recipe translation    ${json_data}
    ${status}=    Get Response Status
    ${success_message}=    Get success message
    Should Not Start With    ${status}    500
    Should Start With    ${success_message}    false

Get success message
    ${response}=    Get Response Body
    ${success}=    Get Json Value    ${response}    /Success
    [Return]    ${success}

Get all categories to translate
    Set Request Headers
    GET    /${instance}/translation/ingredientcategory
    ${status}=    Get Response Status
    [Return]    ${status}

Get category to translate by ID
    [Arguments]    ${category_id}
    Set Request Headers
    GET    /${instance}/translation/ingredientcategory/${category_id}
    ${response_body}=    Get Response Body
    [Return]    ${response_body}

Get category translation part
    ${response_body}=    Get category to translate by ID    ${category_id}
    ${translation_part}=    Get Json Value    ${response_body}    /TranslationIngredientCategory
    [Return]    ${translation_part}

Send category translation
    [Arguments]    ${json_data}
    Set Request Headers
    Set Request Body    ${json_data}
    POST    /${instance}/translation/ingredientcategory/${category_id}
    ${status}=    Get Response Status
    ${body}=    Get Response Body
    [Return]    ${status}

Remove field
    [Arguments]    ${field_name}
    Log    "I'm in Remove field"
    ${translation_part}=    Get category translation part
    ${json_string}=    catenate    ${translation_part}
    ${json}=    evaluate    json.loads('''${json_string}''')    json
    set to dictionary    ${json}
    remove from dictionary    ${json}    ${field_name}
    ${json_string}=    evaluate    json.dumps(${json})    json
    Comment    log    \nNew JSON string:\n${json_string}
    [Return]    ${json_string}

Update category translation
    [Arguments]    ${key}    ${value}
    ${updated_field}=    Run Keyword IF    ${value} == -1    Remove field    ${key}
    ...    ELSE IF    ${value} == ${null}    Update category field    /${key}    null
    ...    ELSE    Update category field    /${key}    ${value}
    ${status}=    Send category translation    ${updated_field}
    Should Start With    ${status}    200

Update category field
    [Arguments]    ${key}    ${value}
    ${translation}=    Get category translation part
    ${translated_json}=    Set Json Value    ${translation}    ${key}    ${value}
    [Return]    ${translated_json}
